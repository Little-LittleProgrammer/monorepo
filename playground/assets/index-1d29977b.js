function B(f,i){for(var s=0;s<i.length;s++){const o=i[s];if(typeof o!="string"&&!Array.isArray(o)){for(const a in o)if(a!=="default"&&!(a in f)){const u=Object.getOwnPropertyDescriptor(o,a);u&&Object.defineProperty(f,a,u.get?u:{enumerable:!0,get:()=>o[a]})}}}return Object.freeze(Object.defineProperty(f,Symbol.toStringTag,{value:"Module"}))}var b={};(function(){var f=tinymce.util.Tools.resolve("tinymce.PluginManager"),i=function(e){return function(t){return e===t}},s=i(void 0),o=tinymce.util.Tools.resolve("tinymce.util.Delay"),a=tinymce.util.Tools.resolve("tinymce.util.LocalStorage"),u=tinymce.util.Tools.resolve("tinymce.util.Tools"),_=function(e){return e.fire("RestoreDraft")},P=function(e){return e.fire("StoreDraft")},R=function(e){return e.fire("RemoveDraft")},g=function(e,t){var r={s:1e3,m:6e4},n=e||t,S=/^(\d+)([ms]?)$/.exec(""+n);return(S[2]?r[S[2]]:1)*parseInt(n,10)},I=function(e){return e.getParam("autosave_ask_before_unload",!0)},c=function(e){var t=document.location;return e.getParam("autosave_prefix","tinymce-autosave-{path}{query}{hash}-{id}-").replace(/{path}/g,t.pathname).replace(/{query}/g,t.search).replace(/{hash}/g,t.hash).replace(/{id}/g,e.id)},x=function(e){return e.getParam("autosave_restore_when_empty",!1)},T=function(e){return g(e.getParam("autosave_interval"),"30s")},w=function(e){return g(e.getParam("autosave_retention"),"20m")},p=function(e,t){if(s(t))return e.dom.isEmpty(e.getBody());var r=u.trim(t);if(r==="")return!0;var n=new DOMParser().parseFromString(r,"text/html");return e.dom.isEmpty(n)},v=function(e){var t=parseInt(a.getItem(c(e)+"time"),10)||0;return new Date().getTime()-t>w(e)?(l(e,!1),!1):!0},l=function(e,t){var r=c(e);a.removeItem(r+"draft"),a.removeItem(r+"time"),t!==!1&&R(e)},y=function(e){var t=c(e);!p(e)&&e.isDirty()&&(a.setItem(t+"draft",e.getContent({format:"raw",no_events:!0})),a.setItem(t+"time",new Date().getTime().toString()),P(e))},m=function(e){var t=c(e);v(e)&&(e.setContent(a.getItem(t+"draft"),{format:"raw"}),_(e))},E=function(e){var t=T(e);o.setEditorInterval(e,function(){y(e)},t)},D=function(e){e.undoManager.transact(function(){m(e),l(e)}),e.focus()},d=function(e){return{hasDraft:function(){return v(e)},storeDraft:function(){return y(e)},restoreDraft:function(){return m(e)},removeDraft:function(t){return l(e,t)},isEmpty:function(t){return p(e,t)}}},A=tinymce.util.Tools.resolve("tinymce.EditorManager"),M=function(e){e.editorManager.on("BeforeUnload",function(t){var r;u.each(A.get(),function(n){n.plugins.autosave&&n.plugins.autosave.storeDraft(),!r&&n.isDirty()&&I(n)&&(r=n.translate("You have unsaved changes are you sure you want to navigate away?"))}),r&&(t.preventDefault(),t.returnValue=r)})},h=function(e){return function(t){t.setDisabled(!v(e));var r=function(){return t.setDisabled(!v(e))};return e.on("StoreDraft RestoreDraft RemoveDraft",r),function(){return e.off("StoreDraft RestoreDraft RemoveDraft",r)}}},O=function(e){E(e),e.ui.registry.addButton("restoredraft",{tooltip:"Restore last draft",icon:"restore-draft",onAction:function(){D(e)},onSetup:h(e)}),e.ui.registry.addMenuItem("restoredraft",{text:"Restore last draft",icon:"restore-draft",onAction:function(){D(e)},onSetup:h(e)})};function k(){f.add("autosave",function(e){return M(e),O(e),e.on("init",function(){x(e)&&e.dom.isEmpty(e.getBody())&&m(e)}),d(e)})}k()})();const $=B({__proto__:null,default:b},[b]);export{$ as i};
